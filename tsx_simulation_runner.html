<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Reality Simulations - Ashman Roonz</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #root {
            min-height: 100vh;
        }
        .simulation-container {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const SimulationRunner = () => {
            const [simulations, setSimulations] = useState([]);
            const [selectedSim, setSelectedSim] = useState(null);
            const [simCode, setSimCode] = useState('');
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(true);

            // Scan simulations directory for TSX files
            useEffect(() => {
                const fetchSimulations = async () => {
                    try {
                        // Try to fetch the simulations directory listing
                        // Note: This requires a server that supports directory listing
                        // or you can manually list files here
                        
                        // Manual listing (update this array with your TSX files)
                        const simFiles = [
                            'harmonic_chemistry.tsx',
                            'water_molecule.tsx',
                            'validation_synchronization.tsx',
                            // Add more simulation files here
                        ];

                        setSimulations(simFiles);
                        setLoading(false);
                    } catch (err) {
                        console.error('Error loading simulations:', err);
                        setError('Could not load simulations directory');
                        setLoading(false);
                    }
                };

                fetchSimulations();
            }, []);

            // Load and execute selected simulation
            const loadSimulation = async (filename) => {
                try {
                    setError(null);
                    setLoading(true);
                    
                    // Fetch the TSX file content
                    const response = await fetch(`./simulations/${filename}`);
                    if (!response.ok) {
                        throw new Error(`Failed to load ${filename}`);
                    }
                    
                    const code = await response.text();
                    setSimCode(code);
                    setSelectedSim(filename);
                    setLoading(false);
                } catch (err) {
                    console.error('Error loading simulation:', err);
                    setError(`Error loading ${filename}: ${err.message}`);
                    setLoading(false);
                }
            };

            // Render the selected simulation
            const SimulationRenderer = () => {
                if (!simCode) return null;

                try {
                    // Transform TSX to JS
                    const transformed = Babel.transform(simCode, {
                        presets: ['react', 'typescript']
                    }).code;

                    // Create a function from the code
                    const SimComponent = new Function(
                        'React',
                        'useState',
                        'useEffect',
                        `${transformed}; return typeof App !== 'undefined' ? App : typeof default !== 'undefined' ? default : null;`
                    )(React, useState, useEffect);

                    if (!SimComponent) {
                        throw new Error('No component exported from simulation');
                    }

                    return <SimComponent />;
                } catch (err) {
                    console.error('Error rendering simulation:', err);
                    return (
                        <div className="p-8 bg-red-50 text-red-900">
                            <h3 className="text-xl font-bold mb-2">Rendering Error</h3>
                            <pre className="text-sm overflow-auto">{err.message}</pre>
                        </div>
                    );
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
                    {!selectedSim ? (
                        // Simulation selector
                        <div className="container mx-auto px-4 py-16">
                            <div className="text-center mb-12">
                                <h1 className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 mb-4">
                                    Fractal Reality Simulations
                                </h1>
                                <p className="text-xl text-cyan-200">
                                    Interactive demonstrations by Ashman Roonz
                                </p>
                                <p className="text-gray-400 mt-2">
                                    github.com/AshmanRoonz/Fractal_Reality
                                </p>
                            </div>

                            {loading ? (
                                <div className="text-center text-cyan-300 text-xl">
                                    Loading simulations...
                                </div>
                            ) : error ? (
                                <div className="max-w-2xl mx-auto bg-red-900/30 border border-red-500 rounded-lg p-6">
                                    <p className="text-red-300">{error}</p>
                                    <p className="text-gray-400 mt-4 text-sm">
                                        Make sure your TSX files are in the ./simulations/ directory
                                    </p>
                                </div>
                            ) : simulations.length === 0 ? (
                                <div className="max-w-2xl mx-auto bg-yellow-900/30 border border-yellow-500 rounded-lg p-6">
                                    <p className="text-yellow-300">No simulations found</p>
                                    <p className="text-gray-400 mt-4 text-sm">
                                        Add TSX files to the ./simulations/ directory and update the file list
                                    </p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                                    {simulations.map((sim, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => loadSimulation(sim)}
                                            className="bg-black/40 hover:bg-black/60 border border-cyan-500/30 hover:border-cyan-500 rounded-xl p-6 text-left transition-all transform hover:scale-105"
                                        >
                                            <h3 className="text-xl font-bold text-cyan-300 mb-2">
                                                {sim.replace('.tsx', '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                            </h3>
                                            <p className="text-gray-400 text-sm">{sim}</p>
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    ) : (
                        // Simulation viewer
                        <div className="simulation-container relative">
                            <button
                                onClick={() => {
                                    setSelectedSim(null);
                                    setSimCode('');
                                    setError(null);
                                }}
                                className="absolute top-4 left-4 z-50 bg-cyan-500 hover:bg-cyan-600 text-black font-bold px-6 py-3 rounded-lg transition-colors"
                            >
                                ‚Üê Back to Simulations
                            </button>
                            
                            {loading ? (
                                <div className="flex items-center justify-center h-screen">
                                    <div className="text-center">
                                        <div className="text-cyan-300 text-2xl mb-4">Loading simulation...</div>
                                        <div className="text-gray-400">{selectedSim}</div>
                                    </div>
                                </div>
                            ) : error ? (
                                <div className="flex items-center justify-center h-screen p-8">
                                    <div className="max-w-2xl bg-red-900/30 border border-red-500 rounded-lg p-6">
                                        <h3 className="text-xl font-bold text-red-300 mb-2">Error</h3>
                                        <p className="text-red-200">{error}</p>
                                    </div>
                                </div>
                            ) : (
                                <SimulationRenderer />
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SimulationRunner />);
    </script>
</body>
</html>